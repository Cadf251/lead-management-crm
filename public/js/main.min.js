(()=>{async function E(e,t,o){try{let i=await(await fetch(e,t)).json();return o&&typeof o=="function"&&o(i),i}catch(r){console.error("Erro na requisi\xE7\xE3o AJAX:",r)}}function S(e,t=null){return E(e,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}},t)}function a(e,t="",o=null){return E(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:t},o)}var b=null;function c(e,t,o=!0,r=null){let i=document.querySelector(".warning");b=r,i.innerHTML=`
    <div>
      <b class="warning__titulo">${e}</b>
      <p class="warning__descricao">${t}</p>

      <div class="warning__buttons">
        ${o?`
              <button class="small-btn small-btn--blue" data-warning-confirm="true">Sim</button>
              <button class="small-btn small-btn--red" data-warning-confirm="false">Cancelar</button>
            `:`
              <button class="small-btn small-btn--blue" data-warning-confirm="true">Ok</button>
            `}
      </div>
    </div>
  `,i.classList.add("warning--show")}function w(){document.addEventListener("click",e=>{let t=e.target.closest("[data-warning-confirm]");if(!t)return;let o=t.dataset.warningConfirm==="true";document.querySelector(".warning").classList.remove("warning--show"),o&&typeof b=="function"&&b(),b=null}),document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("session-warning");if(!e)return;let t=e.dataset.warningTitulo,o=e.dataset.warningMensagem,r=e.dataset.warningAsk==="true";c(t,o,r)})}function j(e,t){var o=t.colaboradorId,r=e.previousElementSibling,i=r.value;a("http://crm.local/alterar-funcao/"+o,"funcao_id="+i,n=>{n.sucesso===!0||n.sucesso!==void 0?(e.dataset.originalValue=i,e.disabled=!0):c(sucesso.alerta,sucesso.mensagens,!1)})}function T(e,t){var o="switch-btn--ativado",r="switch-btn--desativado",i=!e.classList.contains(o),n=t.colaboradorId,s=t.equipeId,m=e.closest("td"),f=m.nextElementSibling,p=f.querySelectorAll("button");a("http://crm.local/alterar-recebimento/"+n,"recebe_leads="+i+"&equipe_id="+s,g=>{if(g.sucesso===!0){i?(e.innerHTML="Sim",e.classList.remove(r),e.classList.add(o),p.forEach(L=>{L.disabled=!1})):(e.innerHTML="N\xE3o",e.classList.remove(o),e.classList.add(r),p.forEach(L=>{L.disabled=!0}));var de=document.querySelector(".js--infobox");de.innerHTML=g.fila}else c(g.alerta,g.mensagens,!1)})}var l="http://crm.local/";function h(e,t){var o=document.querySelector(t);o!==null&&(o.outerHTML=e)}function q(e){var t=document.querySelector(e);t!==null&&t.remove()}function I(e){var t=document.querySelector(e);t!==null&&t.classList.add("is-loading")}function R(e){var t=document.querySelector(e);t!==null&&t.classList.remove("is-loading")}function C(e,t){var o=t.equipeId,r=t.equipeNome;c("Deseja despausar a equipe "+r+"?","Ela voltar\xE1 a receber leads normalmente.",!0,()=>{a(l+"/ativar-equipe/"+o,"",i=>{h(i.html,".card--"+o),c(i.alerta,i.mensagens,!1)})})}function A(e,t){var o=t.colaboradorId,r=t.equipeId;a("http://crm.local/mudar-vez/"+o,"task=prejudicar&equipe_id="+r,i=>{var n=document.querySelector(".js--infobox");n.innerHTML=i.fila})}function H(e,t){var o=t.colaboradorId,r=t.equipeId;a("http://crm.local/mudar-vez/"+o,"task=priorizar&equipe_id="+r,i=>{var n=document.querySelector(".js--infobox");n.innerHTML=i.fila})}function W(){let e=document.querySelector(".js--overlay"),t=document.querySelector(".js--body"),o=document.querySelector(".js--overlay-content"),r=document.querySelector(".js--overlay-close");r!==null&&r.addEventListener("click",()=>{e.classList.contains("overlay--oculto")||c("Deseja fechar?","Todo progresso ser\xE1 descartado.",!0,()=>{e.classList.add("overlay--oculto"),t.classList.remove("congelado"),o.innerHTML=""})})}function d(){let e=document.querySelector(".js--overlay"),t=document.querySelector(".js--body");e.classList.contains("overlay--oculto")&&(e.classList.remove("overlay--oculto"),t.classList.add("congelado"))}function u(e){let t=document.querySelector(".js--overlay-content");t.innerHTML=e}function M(){let e=document.querySelector(".js--overlay"),t=document.querySelector(".js--body");e.classList.add("overlay--oculto"),t.classList.remove("congelado");let o=document.querySelector(".js--overlay-content");o.innerHTML=""}function _(){a("http://crm.local/criar-equipe/","",e=>{d(),u(e.html)})}function k(e,t){var o=t.equipeId,r=t.equipeNome;c("Deseja desativar a equipe "+r+"?","Ela ser\xE1 completamente exclu\xEDda.",!0,()=>{a(l+"/desativar-equipe/"+o,"",i=>{q(".card--"+o),c(i.alerta,i.mensagens,!1)})})}function O(e,t){var o=t.equipeId;a("http://crm.local/editar-equipe/"+o,"",r=>{d(),u(r.html)})}function F(){let e=document.querySelector(".js--usuario-select");if(e===null)return;let t=document.querySelector(".js--usuario-funcao"),o=t.querySelector("option[value='2']");e.addEventListener("change",()=>{let i=e.value.split(",");parseInt(i[1])>=3?(t.selectedIndex=0,o.disabled=!1):(t.selectedIndex=0,o.disabled=!0)})}function N(e,t){var o=t.equipeId;a(l+"novo-colaborador/"+o,"",r=>{d(),u(r.html),F()})}function B(e,t){var o=t.equipeId,r=t.equipeNome;c("Deseja pausar a equipe "+r+"?","Ela n\xE3o receber\xE1 leads enquanto estiver pausada.",!0,()=>{a(l+"/congelar-equipe/"+o,"",i=>{h(i.html,".card--"+o),c(i.alerta,i.mensagens,!1)})})}function D(e,t){var o=t.colaboradorId,r=t.equipeId;a("http://crm.local/remover-colaborador/"+o,"equipe_id="+r,i=>{var n=document.querySelector(".js--infobox");n.innerHTML=i.fila;var s=e.closest("tr");s.remove();var m=document.querySelector(".js--number-badge");m.innerHTML=i.numero})}var $={"equipe:criar":_,"equipe:editar":O,"equipe:desativar":k,"equipe:pausar":B,"equipe:ativar":C,"colaborador:novo":N,"colaborador:alterar-funcao":j,"colaborador:recebimento":T,"colaborador:prejudicar":A,"colaborador:priorizar":H,"colaborador:remover":D};function z(){a("http://crm.local/criar-produto/","",e=>{d(),u(e.html)})}function P(e,t){var o=t.productId,r=t.productName;c("Deseja deletar o produto "+r+"?","Ele ser\xE1 completamente exclu\xEDdo para sempre.",!0,()=>{a(l+"/deletar-produto/"+o,"",i=>{q(".card--"+o),c(i.alerta,i.mensagens,!1)})})}function X(e,t){var o=t.productId;a("http://crm.local/editar-produto/"+o,"",r=>{d(),u(r.html)})}var V={"product:create":z,"product:edit":X,"product:delete":P};function U(){a("http://crm.local/criar-oferta/","",e=>{d(),u(e.html)})}var G={"offer:create":U};var v={container:null,init(){this.container||(document.body.insertAdjacentHTML("beforeend",`
        <div class="floating-action js--floating-container">
          <div class="floating-action__content js--floating-content"></div>
        </div>`),this.container=document.querySelector(".js--floating-container"),this.bindCloseEvents())},bindCloseEvents(){document.addEventListener("mousedown",e=>{this.container?.classList.contains("is-active")&&!this.container.contains(e.target)&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.close()})},open(e,t){this.init();let o=e.getBoundingClientRect(),r=o.left,i=o.top+o.height;console.log("Floating Action disparado!"),console.log("ID solicitado:",t),console.log(`Coordenadas: X:${r} Y:${i}`);let n=this.container.querySelector(".js--floating-content");n.innerHTML='<div class="floating-loader">Simulando Loading...</div>',this.container.classList.add("is-loading"),this.container.classList.add("is-active"),this.setPosition(r,i)},fill(e){var t=this.container.querySelector(".js--floating-content");this.container.classList.remove("is-loading"),t.innerHTML=e},setPosition(e,t){let i=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)/2;e<i?this.container.style.left=`${e+10}px`:(console.log(this.container.offsetWidth),this.container.style.left=`${e-this.container.offsetWidth-10}px`),this.container.style.top=`${t-10}px`},close(){this.container&&(this.container.classList.remove("is-active"),this.container.querySelector(".js--floating-content").innerHTML="")}};function Y(e,t){let o=e;v.open(o,"offer-team"),a(l+"floating-action/offer-team","",r=>{v.fill(r.html)})}function J(e,t){let o=e,r=t.floatingId;v.open(o,r),a(l+"floating-action/"+r,"",i=>{v.fill(i.html)})}var Z={"floating:teste":J,"floating:offer-team":Y};var y=(e,t=null)=>{if(console.log(e),!!e){if(e.redirect){window.location.href=l+e.redirect;return}if(e.updates&&Array.isArray(e.updates)&&e.updates.forEach(o=>{let r=o.target?document.querySelector(o.target):null;switch(o.type){case"update":r&&(r.outerHTML=o.html);break;case"append":r&&r.insertAdjacentHTML("beforeend",o.html);break;case"remove":r&&r.remove();break;case"overlay":d(),u(o.html);break}}),e.close_overlay&&M(),!e.success&&e.csrf_token&&t){let r=t.closest("form")?.querySelector("input[name='csrf_token']");r&&(r.value=e.csrf_token)}e.messages&&setWarning(e.alert,e.messages,!1)}};function K(){document.addEventListener("submit",e=>{e.target.classList.contains("js--form-ajax")&&e.preventDefault()})}var Q={submit(e){let t=e.closest(".js--form-ajax");if(!t||!ue.validate(t))return!1;let o=new FormData(t),r=t.action||window.location.href,i=new URLSearchParams(o).toString();e.disabled=!0;let n=e.innerHTML;e.innerHTML="Enviando...",a(r,i,s=>{e.disabled=!1,e.innerHTML=n,y(s,e)})}},ue={validate(e){let t=e.querySelectorAll("input, select, textarea"),o=!0;return t.forEach(r=>{this.clearError(r),r.hasAttribute("required")&&!r.value.trim()&&(this.setError(r,"Campo obrigat\xF3rio"),o=!1),(r.type==="email"||r.type==="mail")&&r.value&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value)||(this.setError(r,"E-mail inv\xE1lido"),o=!1))}),o},setError(e,t){e.classList.add("input--error");var o=e.closest(".form__campo").querySelector("label");o.innerHTML=o.innerHTML+t},clearError(e){e.classList.remove("input--error")}};function ee(e,t){Q.submit(e)}var te={"form:ajax-submit":ee};var x={run(e,t){let o=t.url;t.confirm?c(t.confirmTitle,t.confirmText,!0,()=>x.execute(o,t)):x.execute(o,e,t)},execute(e,t,o){let r=new URLSearchParams;o.target!==null&&I(o.target),Object.keys(o).forEach(s=>{if(s.startsWith("param")){let m=s.replace("param","").replace(/([A-Z])/g,"_$1").toLowerCase().replace(/^_/,"");r.append(m,o[s])}}),o.include&&document.querySelectorAll(o.include).forEach(s=>{s.name&&s.value!==void 0&&r.append(s.name,s.value)});let i=o.actionType==="overlay",n=s=>{o.target&&R(o.target),y(s,t)};if(i)S(l+e,n);else{let s=r.toString();a(l+e,s,n)}}};var oe={"action:core":x.run};function re(e,t){console.log("Called");var o=e.nextElementSibling;o.classList.contains("is-active")?(o.classList.remove("is-active"),e.classList.remove("is-active")):(o.classList.add("is-active"),e.classList.add("is-active"))}var ie={"ui:hamburguer-controller":re};var ae={...oe,...ie,...$,...V,...G,...Z,...te};function ne(){document.addEventListener("click",e=>{let t=e.target.closest("[data-action]");if(!t)return;let o=t.dataset.action;ae[o]?.(t,t.dataset)})}function se(){let e=document.querySelector(".js--nav");if(!e)return;let t=document.querySelector(".js--main"),o=document.querySelector(".js--nav-button");var r=e.classList,i=t.classList;o.addEventListener("click",()=>{let m=localStorage.getItem("navExpandida")==="true";s(!m,r,i),localStorage.setItem("navExpandida",!m)});function n(){let m=localStorage.getItem("navExpandida")==="true";s(m,r,i),r.contains("nav--preload")&&r.remove("nav--preload")}function s(m,f,p){m?(f.remove("nav--recolhido"),f.add("nav--extendido"),p.remove("main--recolhido"),p.add("main--extendido")):(f.remove("nav--extendido"),f.add("nav--recolhido"),p.remove("main--extendido"),p.add("main--recolhido"))}n()}function ce(){document.addEventListener("change",function(e){let t=e.target;(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT")&&t.closest(".js--form-edit")&&(t.classList.contains("input--changed")||t.classList.add("input--changed"))})}function le(){let e=document.createElement("div"),o=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)/2;e.className="tooltip";function r(n){let s=n.getAttribute("title");s&&(n.dataset.tooltipText=s,n.hasAttribute("data-tooltip-applied")||(n.removeAttribute("title"),n.setAttribute("data-tooltip-applied","true"),n.addEventListener("mouseenter",()=>{e.textContent=n.dataset.tooltipText,e.style.opacity=1}),n.addEventListener("mousemove",m=>{e.style.top=`${m.pageY+12}px`,m.pageX<o?e.style.left=`${m.pageX+12}px`:e.style.left=`${m.pageX-e.offsetWidth-12}px`}),n.addEventListener("mouseleave",()=>{e.style.opacity=0})))}window.onload=()=>{document.body.appendChild(e),document.querySelectorAll("[title]").forEach(r),i.observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["title"]})};let i=new MutationObserver(n=>{n.forEach(s=>{s.type==="attributes"&&s.attributeName==="title"&&r(s.target)})})}function me(){let e=document.querySelectorAll(".js--usuario-funcao");e&&e.forEach(t=>{let o=t.nextElementSibling,r=t.value;t.addEventListener("change",()=>{o.disabled=o.dataset.originalValue===t.value})})}se();W();w();ne();ce();le();me();K();})();
